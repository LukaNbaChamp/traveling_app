<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åå¤å±‹æ»‘é›ª 2026 â„ï¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Noto+Serif+TC:wght@500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        theme: {
                            bg: '#f8f7f4', // ç±³è‰²èƒŒæ™¯
                            text: '#333333', // æ·±ç°æ–‡å­—
                            muted: '#8e8e93', // æ¬¡è¦æ–‡å­—
                            accent: '#5F6B59', // å¢¨ç¶ è‰²å¼·èª¿ (é¡ä¼¼ç¯„ä¾‹ä¸­çš„æ¨™ç±¤èƒŒæ™¯)
                            line: '#e5e5ea', // åˆ†éš”ç·š
                        }
                    },
                    fontFamily: {
                        serif: ['"Noto Serif TC"', 'serif'],
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8f7f4; color: #333; -webkit-tap-highlight-color: transparent; }
        h1, h2, h3, .time-serif { font-family: 'Noto Serif TC', serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        /* ç£¨ç ‚ç»ç’ƒæ•ˆæœç¨å¾®æ¸›å¼±ï¼Œæ›´æº«æ½¤ */
        .glass { background: rgba(248, 247, 244, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .blur-secret { filter: blur(6px); transition: filter 0.3s; cursor: pointer; user-select: none; }
        .blur-secret:active, .blur-secret.revealed { filter: blur(0); }
        
        /* æ–°å¢ï¼šè©³æƒ…é é¢çš„æ¨£å¼ */
        .detail-modal-content { border-radius: 24px 24px 0 0; box-shadow: 0 -4px 20px rgba(0,0,0,0.08); }
        .point-and-speak-box { background-color: #f0efeb; border-radius: 12px; padding: 16px; }
        .gps-box { border: 1px solid #e5e5ea; border-radius: 12px; padding: 16px; display: flex; align-items: center; }
        .detail-paragraph-title { font-weight: 700; color: #333; margin-bottom: 4px; display: block; }
    </style>
</head>
<body class="pb-24 bg-theme-bg">

    <div class="fixed top-0 w-full z-40 glass transition-all duration-300" id="top-bar">
        <div class="flex justify-between items-end px-5 py-4">
            <div>
                <p class="text-xs text-theme-muted tracking-[0.2em] uppercase mb-1">Family Trip</p>
                <h1 class="text-2xl font-bold text-theme-text">åå¤å±‹æ»‘é›ª <span class="text-base font-normal ml-1">2026</span></h1>
            </div>
            <div class="flex items-center space-x-3">
                 <button onclick="showDriverRant()" class="text-red-800 bg-red-100 p-2 rounded-full relative" style="font-size: 10px;">
                     <i class="fas fa-fire"></i>
                     <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-600 rounded-full"></span>
                 </button>
                 <a href="https://www.vjw.digital.go.jp/" target="_blank" class="text-theme-accent border border-theme-accent px-3 py-1 rounded-full text-xs font-medium active:bg-theme-accent active:text-white transition-colors">
                     VJW
                 </a>
            </div>
        </div>
        
        <div class="flex overflow-x-auto hide-scrollbar px-4 pb-3 space-x-2" id="date-scroll">
            </div>
    </div>


    <div class="pt-36 px-5 space-y-8" id="itinerary-container">
        </div>


    <div class="fixed bottom-0 w-full bg-theme-bg/90 backdrop-blur-md border-t border-theme-line flex justify-around py-3 pb-6 z-50 text-[10px] font-medium text-theme-muted">
        <button class="flex flex-col items-center text-theme-accent">
            <i class="fas fa-calendar-day text-lg mb-1"></i>è¡Œç¨‹
        </button>
        <button class="flex flex-col items-center hover:text-theme-text" onclick="window.open('https://www.google.com/maps/search/Nagoya+Japan', '_blank')"> 
            <i class="fas fa-map-marked-alt text-lg mb-1"></i>é–‹å•Ÿåœ°åœ–
        </button>
        <button class="flex flex-col items-center hover:text-theme-text" onclick="showSkiModal()">
            <i class="fas fa-snowflake text-lg mb-1"></i>æ»‘é›ª
        </button>
        <button class="flex flex-col items-center hover:text-theme-text" onclick="showChecklist()">
            <i class="fas fa-clipboard-check text-lg mb-1"></i>æ¸…å–®
        </button>
    </div>


    <div id="modal-event-detail" class="fixed inset-0 bg-black/40 z-[60] hidden flex items-end justify-center transition-opacity duration-300" onclick="closeModal('modal-event-detail')">
        <div class="bg-theme-bg w-full h-[85vh] detail-modal-content overflow-y-auto p-6 relative transition-transform duration-300 translate-y-full" id="event-detail-card" onclick="event.stopPropagation()">
            
            <button onclick="closeModal('modal-event-detail')" class="absolute top-6 right-6 text-theme-muted p-2">
                <i class="fas fa-times text-xl"></i>
            </button>
            
            <div id="event-detail-content" class="mt-2 space-y-6 pb-10">
                </div>

        </div>
    </div>

    <div id="modal-driver" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-6" onclick="closeModal('modal-driver')">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm relative overflow-hidden text-center" onclick="event.stopPropagation()">
            <i class="fas fa-bomb text-4xl text-red-600 mb-4"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-4 font-serif">å¸æ©Ÿçš„å…§å¿ƒç¨ç™½</h3>
            <p id="driver-quote" class="text-lg text-gray-700 font-serif italic mb-8 leading-relaxed">...</p>
            <button onclick="closeModal('modal-driver')" class="w-full bg-theme-accent text-white py-3 rounded-xl font-bold">è¾›è‹¦äº†ï¼Œè«‹å–é£²æ–™ ğŸ¥¤</button>
        </div>
    </div>

    <div id="modal-ski" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-end sm:items-center justify-center" onclick="closeModal('modal-ski')">
        <div class="bg-theme-bg rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md p-6 max-h-[80vh] overflow-y-auto detail-modal-content" onclick="event.stopPropagation()">
            <h3 class="text-xl font-bold mb-6 font-serif flex items-center"><i class="fas fa-skiing text-theme-accent mr-3"></i>æ•™ç·´ & ç§Ÿå€Ÿæ¯”åƒ¹</h3>
            <div class="space-y-4">
                <p class="text-sm text-theme-muted">æ­¤è™•çœç•¥æ»‘é›ªæ¯”åƒ¹å…§å®¹ï¼Œè«‹ä½¿ç”¨åŸç‰ˆä»£ç¢¼å¡«å……ã€‚</p>
            </div>
            <button onclick="closeModal('modal-ski')" class="mt-6 w-full bg-theme-line text-theme-text py-3 rounded-xl font-bold">é—œé–‰</button>
        </div>
    </div>

    <div id="modal-checklist" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-end sm:items-center justify-center" onclick="closeModal('modal-checklist')">
         <div class="bg-theme-bg rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md p-6 h-[70vh] flex flex-col detail-modal-content" onclick="event.stopPropagation()">
             <h3 class="text-xl font-bold mb-6 font-serif">è¡Œææª¢æŸ¥è¡¨</h3>
             <div class="flex-1 overflow-y-auto space-y-2">
                 <label class="flex items-center p-3 bg-white border border-theme-line rounded-lg">
                     <input type="checkbox" class="w-5 h-5 text-theme-accent rounded focus:ring-theme-accent">
                     <span class="ml-3 text-theme-text">å°ç£é§•ç…§ + æ—¥æ–‡è­¯æœ¬ (çµ•å°è¦å¸¶!!)</span>
                 </label>
                 <label class="flex items-center p-3 bg-white border border-theme-line rounded-lg">
                     <input type="checkbox" class="w-5 h-5 text-theme-accent rounded">
                     <span class="ml-3 text-theme-text">è­·ç…§ (æª¢æŸ¥æ•ˆæœŸ)</span>
                 </label>
             </div>
             <button onclick="closeModal('modal-checklist')" class="mt-4 w-full bg-theme-accent text-white py-3 rounded-xl font-bold">å®Œæˆ</button>
         </div>
    </div>


    <script>
        // === è³‡æ–™ä¸­å¿ƒ (å·²æ•´åˆç²¾ç°¡å¾Œçš„ Day 3, Day 5, Day 6 å…§å®¹) ===
        const tripData = [
            // Day 1: 1/17 (å…­) - (å®Œæ•´å…§å®¹ï¼Œä¿æŒä¸è®Š)
            {
                date: "1/17", day: "Day 1", week: "å…­", city: "Takayama", weatherCity: "Takayama",
                events: [
                    { 
                        time: "06:45", title: "æŠµé” åå¤å±‹ (MM722)", type: "flight", categoryEN: "FLIGHT",
                        desc: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´ T1 / æ¨‚æ¡ƒèˆªç©º",
                    },
                    { 
                        time: "08:00", title: "å–è»Š (ORIX Rent-A-Car)", type: "car", categoryEN: "TRANSPORT",
                        desc: "å‚™å¦¥é§•ç…§è­¯æœ¬ï¼Œå‰å¾€æ«ƒæª¯ã€‚",
                        address: "æ„›çŸ¥çœŒå¸¸æ»‘å¸‚ã‚»ãƒ³ãƒˆãƒ¬ã‚¢1-1 (ä¸­éƒ¨åœ‹éš›æ©Ÿå ´åº—)",
                        gpsPhone: "0569-38-7660", 
                        parkingTarget: { shown: "ã‚ªãƒªãƒƒã‚¯ã‚¹ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼", read: "Oricks Rent-a-car" }, 
                        details: [
                            { title: "ã€å–è»Šæ”»ç•¥ã€‘", content: "å‡ºé—œå¾Œè«‹å¾€ã€Œäº¤é€šå»£å ´ (Access Plaza)ã€æ–¹å‘ç§»å‹•ã€‚ORIX æ«ƒæª¯é€šå¸¸äººæ¯”è¼ƒå¤šï¼Œå»ºè­°ä¸€äººå…ˆå»æ’éšŠï¼Œå…¶ä»–äººé ˜è¡Œæã€‚è«‹ç¢ºèªæ˜¯å¦æœ‰ç§Ÿå€Ÿ ETC å¡ã€‚" },
                            { title: "ã€é‡è¦æé†’ã€‘", content: "å‡ºç™¼å‰è«‹å‹™å¿…æª¢æŸ¥è»Šèº«åˆ®ç—•ä¸¦æ‹ç…§éŒ„å½±ç•™å­˜ã€‚è¨­å®šå¥½å°èˆªè‡³ä¸‹ä¸€ç«™å†å‡ºç™¼ã€‚" }
                        ]
                    },
                    { 
                        time: "12:00", title: "é«˜å±±è€è¡— åˆé¤", type: "food", categoryEN: "FOOD",
                        desc: "é£›é©’ç‰›æ¡å£½å¸ / é€›è¡—",
                        address: "å²é˜œçœŒé«˜å±±å¸‚ä¸Šä¸‰ä¹‹ç”º",
                        gpsPhone: "0577-32-3333", // (é«˜å±±è§€å…‰æ¡ˆå…§æ‰€ä»£è¡¨è™Ÿ)
                        parkingTarget: { shown: "å¸‚å–¶ç¥æ˜é§è»Šå ´", read: "ã—ãˆã„ã—ã‚“ã‚ã„ã¡ã‚…ã†ã—ã‚ƒã˜ã‚‡ã†" },
                        details: [
                            { title: "ã€åœè»Šæ”»ç•¥ã€‘", content: "è€è¡—å€ç¦æ­¢è»Šè¼›é€²å…¥ã€‚æ¨è–¦åœåœ¨ã€Œå¸‚ç‡Ÿç¥æ˜åœè»Šå ´ã€æˆ–ã€Œå¸‚ç‡Ÿä¸å‹•æ©‹åœè»Šå ´ã€ï¼Œæ­¥è¡Œè‡³è€è¡—ç´„ 5-10 åˆ†é˜ã€‚è²»ç”¨ç´„ç‚º 30åˆ†é˜ 150æ—¥åœ“ã€‚" },
                            { title: "ã€å¿…åƒç¾é£Ÿã€‘", content: "ä¸€å®šè¦è©¦è©¦ã€Œé£›é©’ç‰›æ¡å£½å¸ã€ï¼é€šå¸¸æ˜¯ç”¨ç…é¤…ç•¶ç›¤å­ç››è£ã€‚å¦å¤–æ¨è–¦äº”å¹³é¤…å’Œé£›é©’ç‰›ä¸²ç‡’ã€‚" },
                            { title: "ã€æ•£æ­¥é‡é»ã€‘", content: "ä¸»è¦é€›ã€Œä¸Šä¸‰ä¹‹ç”ºã€ï¼Œä¿ç•™äº†æ±Ÿæˆ¶æ™‚ä»£çš„æœ¨é€ å»ºç¯‰ï¼Œéå¸¸å¥½æ‹ã€‚æ³¨æ„å¤§éƒ¨åˆ†åº—å®¶ç´„ 17:00 å°±æœƒé—œé–€ã€‚" }
                        ]
                    },
                    { 
                        time: "15:00", title: "Check-in: é£›é©’èŠ±é‡Œä¹‹æ¹¯", type: "hotel", categoryEN: "HOTEL",
                        desc: "é«˜å±±æ«»åºµ (æš«å®š)",
                        address: "å²é˜œçœŒé«˜å±±å¸‚èŠ±é‡Œç”º4-126",
                        gpsPhone: "0577-37-2230",
                        parkingTarget: { shown: "é«˜å±±æ¡œåºµã®é§è»Šå ´", read: "ãŸã‹ã‚„ã¾ãŠã†ã‚ã‚“ ã® ã¡ã‚…ã†ã—ã‚ƒã˜ã‚‡ã†" },
                        details: [
                            { title: "ã€ä½å®¿è³‡è¨Šã€‘", content: "æ•´æ£Ÿéƒ½é‹ªè¨­å¡Œå¡Œç±³çš„æº«æ³‰é£¯åº—ã€‚é ‚æ¨“æœ‰éœ²å¤©æº«æ³‰ï¼Œè¦–é‡å¾ˆå¥½ã€‚è®°å¾—åœ¨å¤§å…æŒ‘é€‰å–œæ¬¢çš„æµ´è¡£ã€‚" },
                            { title: "ã€åœè»Šè³‡è¨Šã€‘", content: "é£¯åº—æœ‰é™„è¨­åœè»Šå ´ï¼ˆæ©Ÿæ¢°å¼ç‚ºä¸»ï¼‰ï¼Œæ¯æ™šè²»ç”¨ç´„ 1000 æ—¥åœ“ã€‚å¦‚æœæ»¿äº†éœ€è¦åœåˆ°é™„è¿‘çš„ç‰¹ç´„åœè»Šå ´ã€‚" }
                        ]
                    }
                ]
            },
            // Day 2: 1/18 (æ—¥) - (ä¿æŒä¸è®Š)
            {
                date: "1/18", day: "Day 2", week: "æ—¥", city: "Shirakawa", weatherCity: "Gujo",
                events: [
                    { time: "05:00", title: "èµ·åºŠ", type: "other", categoryEN: "OTHER", desc: "æ—©èµ·ç—›è‹¦ä½†å€¼å¾—" },
                    { time: "06:00", title: "å‡ºç™¼å‰å¾€ ç™½å·é„‰", type: "car", categoryEN: "DRIVE", desc: "è»Šç¨‹ç´„ 1 å°æ™‚" },
                    { time: "07:00", title: "ç™½å·é„‰åˆæŒæ‘", type: "sight", categoryEN: "SIGHTSEEING", desc: "ä¸–ç•Œéºç”¢ / æ‹ç…§", link: "https://goo.gl/maps/R3g7e8J9vYg8J7k9" },
                ]
            },
            
            // Day 3: 1/19 (ä¸€) - ã€å·²ç²¾ç°¡ã€‘é‡‘æ¾¤è¡Œç¨‹
            {
                date: "1/19", day: "Day 3", week: "ä¸€", city: "Kanazawa", weatherCity: "Kanazawa",
                events: [
                    { 
                        time: "10:00", title: "è¿‘æ±Ÿç”ºå¸‚å ´ (åˆé¤)", type: "food", categoryEN: "FOOD", 
                        desc: "é‡‘æ¾¤çš„å»šæˆ¿ï¼å¿…åƒæµ·é®®ä¸¼é£¯ã€‚", 
                        address: "çŸ³å·çœŒé‡‘æ²¢å¸‚ä¸Šè¿‘æ±Ÿç”º50",
                        details: [
                            { title: "åœè»Š/äº¤é€š", content: "åœåœ¨ã€Œå¸‚ç‡Ÿè¿‘æ±Ÿç”ºåœè»Šå ´ã€ã€‚å¸‚å ´é›¢è»Šç«™ç´„ 15 åˆ†é˜è…³ç¨‹ï¼Œå»ºè­°æ­è»Šå‰å¾€ã€‚" },
                            { title: "å¸‚å ´å¿…åƒ", content: "å¿…åƒæ–°é®®æµ·é®®ä¸¼é£¯ã€ç¾çƒ¤æµ·è†½/ç‰¡è £ã€‚äººæ°£åº—ä¸­åˆå‰äººå¤šï¼Œè¦ææ—©ã€‚" },
                        ]
                    },
                    { 
                        time: "14:00", title: "å…¼å…­åœ’", type: "sight", categoryEN: "SIGHTSEEING", 
                        desc: "æ—¥æœ¬ä¸‰å¤§ååœ’ä¹‹é¦–ï¼Œæ¬£è³å†¬å­£é›ªåŠã€‚", 
                        address: "çŸ³å·çœŒé‡‘æ²¢å¸‚å…¼å…­ç”ºï¼‘",
                        details: [
                            { title: "å…¼å…­åœ’å†¬å­£", content: "å†¬å­£ç‰¹æœ‰ã€Œé›ªåŠã€å¥‡æ™¯ï¼Œä¿è­·æ¨¹æœ¨ã€‚é‡é»çœ‹å¾½è»«ç‡ˆç± èˆ‡éœæ± é›ªæ™¯ã€‚" },
                            { title: "é–€ç¥¨/æ™‚é–“", content: "æˆäººé–€ç¥¨ 320 æ—¥åœ“ã€‚æ³¨æ„å†¬å­£é–‹é–‰åœ’æ™‚é–“ã€‚" },
                        ]
                    },
                ]
            },
            
            // Day 4: 1/20 (äºŒ) - (ä¿æŒä¸è®Š)
            {
                date: "1/20", day: "Day 4", week: "äºŒ", city: "Tsugaike", weatherCity: "Otari",
                events: [
                    { time: "09:00", title: "æ ‚æ± é«˜åŸæ»‘é›ªå ´", type: "ski", categoryEN: "SKI RESORT", desc: "åˆå­¸è€…å‹å–„ / é˜é³´ä¹‹ä¸˜", link: "https://www.tsugaike.gr.jp/", address: "é•·é‡çœŒåŒ—å®‰æ›‡éƒ¡å°è°·æ‘åƒå›½ä¹™" },
                ]
            },
            
            // Day 5: 1/21 (ä¸‰) - ã€å·²ç²¾ç°¡ã€‘ç™½é¦¬æ»‘é›ªè¡Œç¨‹
            {
                date: "1/21", day: "Day 5", week: "ä¸‰", city: "Hakuba", weatherCity: "Hakuba",
                events: [
                    { 
                        time: "09:00", title: "ç™½é¦¬äº”é¾æ»‘é›ªå ´ (Hakuba Goryu)", type: "ski", categoryEN: "SKI RESORT", 
                        desc: "ä¸­é«˜ç´šé¦–é¸ï¼Œä½†å±±è…³æœ‰å¹³ç·©å€ã€‚å¯é€šå¾€ Hakuba 47ã€‚",
                        address: "é•·é‡çœŒåŒ—å®‰æ›‡éƒ¡ç™½é¦¬æ‘ç¥åŸ22184-10",
                        details: [
                            { title: "é›ªå ´ç°¡ä»‹", content: "èˆ‡ Hakuba 47 å…±é€šé›ªç¥¨ã€‚é©åˆä¸­é«˜ç´šç©å®¶ï¼Œä½†å±±è…³ Toomi å€æœ‰å¯¬æ•å¹³ç·©å€å¯ç·´ç¿’ã€‚" },
                            { title: "æ–°æ‰‹å€", content: "æ¨è–¦ Toomi æˆ– Iimori ç·´ç¿’å€ã€‚Iimori å€åŸŸè¨­æœ‰å®¶åº­æ¨‚åœ’ã€‚" },
                            { title: "æœå‹™/å¤œæ»‘", content: "æ»‘é›ªä¸­å¿ƒ Escal Plaza æœ‰ 24 å°æ™‚æ«ƒå°/ä¾¿åˆ©åº—ã€‚æ­¤è™•å¯å¤œæ»‘ (18:00~21:30)ã€‚" },
                            { title: "é«˜éšæé†’", content: "å±±é ‚ Alps-daira é›ªè³ªå¥½ï¼Œä½†é›ªé“æœ€å¤§ 35 åº¦é™¡å¡ï¼Œè«‹æ³¨æ„å®‰å…¨ã€‚" },
                        ]
                    },
                ]
            },

            // Day 6: 1/22 (å››) - ã€å·²ç²¾ç°¡ã€‘æˆ¶éš±ç¥ç¤¾ / é‡å°»æ¹–
            {
                date: "1/22", day: "Day 6", week: "å››", city: "Nojiri", weatherCity: "Nagano",
                events: [
                    { 
                        time: "11:00", title: "æˆ¶éš±ç¥ç¤¾ / é‡å°»æ¹–", type: "sight", categoryEN: "SIGHTSEEING", 
                        desc: "é›ªä¸­åƒæ‹œæ‰æ—ï¼Œæ¬£è³é‡å°»æ¹–å†¬æ™¯ã€‚", 
                        secret: "æ‰¾æ¡‘æ‹¿è’¸ä¸€ä¸‹åšæ„› ğŸ£ğŸ§–â™¨ï¸",
                        address: "é•·é‡çœŒé•·é‡å¸‚æˆ¸éš 3501 (ä¸­ç¤¾)",
                        details: [
                            { title: "å¥§ç¤¾åƒæ‹œ", content: "åƒæ‹œå¥§ç¤¾ï¼Œçœ‹å››ç™¾å¹´å·¨æ‰æ—åƒé“ã€‚å†¬å­£æ™¯è§€å£¯è§€ï¼Œä½†å¥§ç¤¾å¯èƒ½é—œé–‰ã€‚" },
                            { title: "è£å‚™æé†’", content: "åƒé“ç©é›ªæ·±ä¸”çµå†°ï¼Œå¼·çƒˆå»ºè­°ç©¿å†°çˆª (Ice Cleats) ä¸¦å‚™å¦¥é˜²æ°´ä¿æš–è£å‚™ã€‚" },
                            { title: "æˆ¶éš±è•éº¥éºµ", content: "æ—¥æœ¬ä¸‰å¤§è•éº¥éºµç”¢åœ°ä¹‹ä¸€ã€‚æ¨è–¦å“åšç•¶åœ°ç‰¹è‰²è•éº¥éºµã€‚" },
                            { title: "é‡å°»æ¹–", content: "é›ªæ³è¨±å¯ï¼Œå¯æ­çºœè»Šè‡³é‡å°»æ¹– Terraceï¼Œåœ¨é›ªä¸­è³æ™¯å–å’–å•¡ã€‚" },
                        ]
                    },
                ]
            },
            // Day 7: 1/23 (äº”) - (ä¿æŒä¸è®Š)
            {
                date: "1/23", day: "Day 7", week: "äº”", city: "Jigokudani", weatherCity: "Nagano",
                events: [
                    { time: "14:00", title: "å‰å¾€ é‡‘æ¾¤", type: "car", categoryEN: "DRIVE", desc: "é•·é€”é§•é§›é–‹å§‹...", rant: "é–‹å»é‡‘æ¾¤æˆ‘æ“ä½ åª½ä½ å€‘æœ€å¥½éƒ½è«‹æˆ‘åƒé£¯æˆ‘é–‹è»Šå¾ˆç´¯é‚„å®‰æ’è¡Œç¨‹æ“" }
                ]
            },
            
            // Day 8: 1/24 (å…­) - (Placeholder)
            {
                date: "1/24", day: "Day 8", week: "å…­", city: "Nagoya", weatherCity: "Nagoya",
                events: [
                    { time: "10:00", title: "ã€ğŸš§ è«‹å¡«å¯«ã€‘é‡‘æ¾¤å›ç¨‹è‡³åå¤å±‹", type: "car", categoryEN: "DRIVE", desc: "é•·é€”é§•é§›å›åå¤å±‹å¸‚å€ï¼Œæº–å‚™é‚„è»Š" },
                ]
            },

            // Day 9: 1/25 (æ—¥) - (Placeholder)
            {
                date: "1/25", day: "Day 9", week: "æ—¥", city: "Nagoya", weatherCity: "Nagoya",
                events: [
                    { time: "09:00", title: "é‚„è»Š (ORIX Rent-A-Car)", type: "car", categoryEN: "TRANSPORT", desc: "æª¢æŸ¥æ²¹é‡èˆ‡è»Šèº«ï¼Œç¢ºèª ETC å¡æ­¸é‚„" },
                    { time: "12:00", title: "åˆé¤ / æ©Ÿå ´å ±åˆ°", type: "food", categoryEN: "FLIGHT", desc: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´ T1" },
                    { time: "15:00", title: "è¿”å° (MM727)", type: "flight", categoryEN: "FLIGHT", desc: "çµæŸç¾å¥½çš„æ—…ç¨‹ï¼" },
                ]
            },
        ];

        const driverRants = [
            "é–‹è»Šå»åå¤å±‹æˆ‘çœŸçš„è¦ºå¾—ä½ å€‘è¦çµ¦æˆ‘éŒ¢æˆ–æ˜¯çµ¦æˆ‘æ“æˆ‘ä»–åª½è¶…ç´¯è¶…å¿™è¿˜å……ç•¶ç¿»è­¯é§•é§›å°éŠæ»‘é›ªæ•™ç·´å»šå¸«æˆ‘å¹¹ä½ å¨˜",
            "é–‹å»é‡‘æ¾¤æˆ‘æ“ä½ åª½ä½ å€‘æœ€å¥½éƒ½è«‹æˆ‘åƒé£¯æˆ‘é–‹è»Šå¾ˆç´¯é‚„å®‰æ’è¡Œç¨‹æ“",
            "ç‚ºä»€éº¼åªæœ‰æˆ‘è¦è² è²¬é–‹è»Šé‚„è¦è² è²¬è¨‚ä½ï¼Ÿ",
            "é€™é›ªåœ°é–‹è»Šå¾ˆæ»‘ä½ å€‘çŸ¥é“å—ï¼Ÿç¡ç¡ç¡å°±çŸ¥é“ç¡ï¼",
            "å¾Œåº§çš„ï¼Œä¸è¦å†åƒæ±è¥¿äº†ï¼Œæ‰å±‘å±‘å¾ˆé›£æ¸…ï¼"
        ];
        
        // ã€æ–°å¢å·¥å…·å‡½å¼ã€‘ æ ¹æ“š URL çŒœæ¸¬ç¶²ç«™åç¨± (ä¿æŒä¸è®Š)
        function guessDomainName(url) {
            if (!url) return 'ç¶²ç«™';
            try {
                const domain = new URL(url).hostname;
                if (domain.includes('tsugaike')) return 'æ ‚æ± å®˜ç¶²';
                if (domain.includes('goo.gl/maps') || domain.includes('google.com/maps')) return 'Google Maps';
                if (domain.includes('gr.jp')) return 'æ—¥æœ¬å®˜ç¶²';
                const parts = domain.split('.');
                return parts.length > 2 ? parts[parts.length - 2] : parts[0] || 'ç¶²ç«™';
            } catch (e) {
                return 'é€£çµç¶²ç«™';
            }
        }

        // === æ ¸å¿ƒé‚è¼¯ (ä¿æŒä¸è®Š) ===
        let currentDayIdx = 0;

        function init() {
            renderTabs();
            renderDay(0);
        }

        function renderTabs() {
            const container = document.getElementById('date-scroll');
            container.innerHTML = tripData.map((d, i) => `
                <button onclick="renderDay(${i})" class="flex-shrink-0 flex flex-col items-center justify-center w-12 h-16 rounded-full transition-all ${i === currentDayIdx ? 'bg-theme-text text-white shadow-md scale-105' : 'text-theme-muted hover:bg-white'}">
                    <span class="text-[10px] font-medium uppercase tracking-wider">${d.day}</span>
                    <span class="text-xl font-bold leading-none mt-0.5 time-serif">${d.date.split('/')[1]}</span>
                    <span class="text-[10px] opacity-80 mt-0.5">${d.week}</span>
                </button>
            `).join('');
            
            const activeTab = container.querySelector('.bg-theme-text');
            if(activeTab) {
                activeTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }

        async function renderDay(idx) {
            currentDayIdx = idx;
            renderTabs(); 
            const day = tripData[idx];
            const container = document.getElementById('itinerary-container');
            
            // å¤©æ°£ API é‚è¼¯ (ç•¥)
            let temp = "--";
            try {
                const latLong = { 'Nagoya': '35.18,136.90', 'Takayama': '36.14,137.25', 'Hakuba': '36.69,137.86', 'Kanazawa': '36.56,136.65', 'Gujo': '35.75,136.96', 'Nagano': '36.65,138.19', 'Otari': '36.77,137.90' };
                const coords = latLong[day.weatherCity] || latLong['Nagoya'];
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${coords.split(',')[0]}&longitude=${coords.split(',')[1]}&current_weather=true`);
                const data = await res.json();
                temp = Math.round(data.current_weather.temperature);
            } catch(e) { console.error("Weather fetch failed", e); }

            // å¤©æ°£å¡ç‰‡ HTML (ç•¥)
            let html = `
                <div class="bg-white rounded-[2rem] p-6 shadow-[0_8px_30px_rgb(0,0,0,0.04)] flex justify-between items-center relative overflow-hidden mb-10">
                    <div>
                        <div class="text-xs font-bold text-theme-muted uppercase tracking-[0.2em] mb-2">${day.city}</div>
                        <div class="flex items-baseline space-x-3">
                            <span class="text-5xl font-bold text-theme-text time-serif">${temp}Â°</span>
                            <span class="text-sm text-theme-muted font-medium">Forecast</span>
                        </div>
                    </div>
                    <div class="text-7xl text-amber-400 opacity-20 absolute -right-4 -top-6"><i class="fas fa-sun"></i></div>
                </div>
            `;

            // è¡Œç¨‹åˆ—è¡¨æ¸²æŸ“ HTML (ç•¥)
            html += day.events.map((ev, eventIdx) => `
                <div class="flex gap-6 relative group cursor-pointer" onclick="openEventDetail(${idx}, ${eventIdx})">
                    <div class="absolute left-[4.5rem] top-10 bottom-0 w-px bg-theme-line z-0 group-last:hidden"></div>

                    <div class="w-16 pt-3 text-right flex-shrink-0 relative z-10">
                        <span class="text-xl font-bold text-theme-text time-serif relative">
                            ${ev.time}
                            <span class="absolute top-1/2 -translate-y-1/2 -right-7 w-2.5 h-2.5 bg-theme-bg border-2 ${getDotBorderColor(ev.type)} rounded-full"></span>
                        </span>
                    </div>

                    <div class="flex-1 pt-2 pb-12 relative">
                        <div class="flex items-center space-x-2 mb-1.5">
                            <span class="text-[10px] font-bold tracking-widest text-theme-accent uppercase">${ev.categoryEN || ev.type}</span>
                            ${ev.rant ? `<i class="fas fa-fire text-red-500 text-xs animate-pulse"></i>` : ''}
                        </div>
                        <h3 class="font-bold text-theme-text text-2xl leading-tight mb-2 font-serif">${ev.title}</h3>
                        <p class="text-sm text-theme-muted font-medium leading-relaxed line-clamp-2">${ev.desc}</p>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // === é–‹å•Ÿæ™¯é»è©³ç´° Modal (ä¿æŒä¸è®Š) ===
        function openEventDetail(dayIdx, eventIdx) {
            const ev = tripData[dayIdx].events[eventIdx];
            const modal = document.getElementById('modal-event-detail');
            const card = document.getElementById('event-detail-card');
            const container = document.getElementById('event-detail-content');

            // æ§‹å»ºè©³æƒ…é  HTML (ç•¥)
            let detailsHtml = `
                <div class="flex items-center space-x-2 mb-4">
                    <span class="bg-theme-accent text-white px-2 py-0.5 text-[10px] font-bold tracking-widest uppercase">${ev.categoryEN || ev.type}</span>
                    <span class="text-theme-muted text-sm time-serif"><i class="far fa-clock mr-1"></i>${ev.time}</span>
                </div>
                <h2 class="text-3xl font-bold text-theme-text mb-4 font-serif">${ev.title}</h2>
                
                ${ev.address ? `
                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.address)}" target="_blank" class="flex items-start text-theme-muted text-sm mb-8 hover:text-theme-accent transition-colors">
                        <i class="fas fa-map-marker-alt mt-1 mr-3 text-theme-accent"></i>
                        <span class="flex-1 leading-relaxed">${ev.address}</span>
                    </a>
                ` : ''}

                ${ev.secret ? `
                    <div class="mb-8 p-4 bg-pink-50 rounded-xl text-pink-900 text-sm font-medium blur-secret relative text-center" onclick="this.classList.toggle('revealed')">
                        <div class="absolute inset-0 flex items-center justify-center text-xs text-pink-500 font-bold uppercase tracking-widest pointer-events-none z-10">Tap to Reveal â¤ï¸</div>
                        <i class="fas fa-user-secret mr-2"></i> ${ev.secret}
                    </div>
                ` : ''}

                ${ev.parkingTarget ? `
                    <div class="mb-6">
                        <h4 class="text-xs font-bold text-theme-muted uppercase tracking-widest mb-3"><i class="fas fa-comment-alt mr-2"></i>æŒ‡å·®ã—ä¼šè©± (Point & Speak)</h4>
                        <div class="point-and-speak-box flex justify-between items-center">
                            <div>
                                <div class="font-bold text-lg text-theme-text">${ev.parkingTarget.shown}</div>
                                <div class="text-xs text-theme-muted">${ev.parkingTarget.read}</div>
                            </div>
                            <div class="text-xs text-theme-muted text-right">æ­¤è™•ç‚º<br>ç›®çš„åœ°</div>
                        </div>
                    </div>
                ` : ''}
                
                ${ev.gpsPhone ? `
                    <div class="mb-8">
                        <h4 class="text-xs font-bold text-theme-muted uppercase tracking-widest mb-3">CAR GPS PHONE NUMBER</h4>
                        <div class="gps-box bg-white">
                            <i class="fas fa-location-arrow text-theme-accent text-xl mx-2"></i>
                            <div class="flex-1 text-center font-bold text-2xl text-theme-text time-serif tracking-widest">${ev.gpsPhone}</div>
                        </div>
                        <p class="text-[10px] text-center text-theme-muted mt-2">è«‹åœ¨è»Šè¼‰å°èˆªç³»çµ±è¼¸å…¥æ­¤é›»è©±è™Ÿç¢¼é€²è¡Œå®šä½</p>
                    </div>
                ` : ''}
                
                <hr class="border-theme-line my-8">

                <div class="space-y-6 text-theme-text leading-relaxed">
                    ${ev.details ? ev.details.map(p => `
                        <div>
                            <span class="detail-paragraph-title">${p.title}</span>
                            <p>${p.content}</p>
                        </div>
                    `).join('') : (ev.desc ? `<p>${ev.desc}</p>` : '<p class="text-theme-muted text-center py-8">å°šç„¡è©³ç´°è³‡è¨Š</p>')}
                </div>
            `;

            // --- åº•éƒ¨æŒ‰éˆ•å€å¡Š (ç¶­æŒä¿®æ­£å¾Œçš„é‚è¼¯) ---
            
            const mapSearchUrl = ev.address 
                ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.address)}`
                : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.title)}`;

            let buttonHtml = '';

            // 1. ã€åŸç‰ˆ Link æŒ‰éˆ•ã€‘ (ä¿®æ­£: å€åˆ†åœ°åœ–æˆ–å¤–éƒ¨ç¶²ç«™)
            if (ev.link) {
                const domainName = guessDomainName(ev.link);
                
                // å¦‚æœæ˜¯å¤–éƒ¨ç¶²ç«™é€£çµ (ä¸æ˜¯åœ°åœ–é€£çµ)
                if (domainName !== 'Google Maps') {
                    // æŒ‰éˆ• A: å¤–éƒ¨ç¶²ç«™æŒ‰éˆ•
                    buttonHtml += `<button onclick="window.open('${ev.link}', '_blank')" class="w-full bg-theme-accent text-white py-4 rounded-full font-bold flex items-center justify-center">
                        <i class="fas fa-external-link-alt mr-2"></i>é–‹å•Ÿ ${domainName}
                    </button>`;
                    
                    // æŒ‰éˆ• B: æ­é…åœ°åœ–æœç´¢æŒ‰éˆ•
                    if (ev.address || ev.title) {
                        buttonHtml += `<button onclick="window.open('${mapSearchUrl}', '_blank')" class="w-full bg-theme-text text-white py-4 rounded-full font-bold flex items-center justify-center">
                            <i class="fas fa-map-marked-alt mr-2"></i>é–‹å•Ÿ Google Maps
                        </button>`;
                    }
                } 
                // å¦‚æœæ˜¯åœ°åœ–é€£çµï¼Œåªé¡¯ç¤ºä¸€å€‹æŒ‰éˆ•
                else {
                    buttonHtml += `<button onclick="window.open('${ev.link}', '_blank')" class="w-full bg-theme-text text-white py-4 rounded-full font-bold flex items-center justify-center">
                        <i class="fas fa-map-marked-alt mr-2"></i>é–‹å•Ÿ Google Maps
                    </button>`;
                }
            } 
            // 2. ã€GPS é›»è©±è™Ÿç¢¼æŒ‰éˆ•ã€‘ (ä¿®æ­£ 3: å¦‚æœæœ‰é›»è©±ï¼Œä½†æ²’æœ‰ linkï¼Œæä¾›åœ°åœ–)
            else if (ev.gpsPhone && (ev.address || ev.title)) {
                buttonHtml += `<button onclick="window.open('${mapSearchUrl}', '_blank')" class="w-full bg-theme-text text-white py-4 rounded-full font-bold flex items-center justify-center">
                    <i class="fas fa-mobile-alt mr-2"></i>æ‰‹æ©Ÿé–‹å•Ÿåœ°åœ– (å°èˆªç”¨)
                </button>`;
            }


            // 3. ã€å¸æ©Ÿæ€’æ°£æŒ‰éˆ•ã€‘ (ä¿æŒä¸è®Š)
            const rantButton = ev.rant ? `<button onclick="showDriverRant('${ev.rant.replace(/'/g, "\\'")}')" class="w-full bg-red-50 text-red-600 py-4 rounded-full font-bold flex items-center justify-center">
                <i class="fas fa-fire mr-2"></i>æŸ¥çœ‹å¸æ©Ÿæ€’æ°£
            </button>` : '';

            detailsHtml += `
                <div class="pt-10 pb-24 space-y-3">
                    ${buttonHtml}
                    ${rantButton}
                </div>
            `;
            // --- åº•éƒ¨æŒ‰éˆ•å€å¡ŠçµæŸ ---

            container.innerHTML = detailsHtml;

            // é¡¯ç¤º Modal ä¸¦è§¸ç™¼å‹•ç•« (ç•¥)
            modal.classList.remove('hidden');
            setTimeout(() => {
                 card.classList.remove('translate-y-full');
            }, 10);
            
            card.scrollTop = 0;
        }


        // === å·¥å…·å‡½å¼ (ä¿æŒä¸è®Š) ===
        function getDotBorderColor(t) {
            return ({ flight:'border-theme-accent', ski:'border-theme-accent' }[t] || 'border-theme-line');
        }

        function showDriverRant(text) {
            const quote = text || driverRants[Math.floor(Math.random() * driverRants.length)];
            document.getElementById('driver-quote').innerText = `"${quote}"`;
            document.getElementById('modal-driver').classList.remove('hidden');
        }
        function showSkiModal() { document.getElementById('modal-ski').classList.remove('hidden'); }
        function showChecklist() { document.getElementById('modal-checklist').classList.remove('hidden'); }
        function closeModal(id) {
            const modal = document.getElementById(id);
            if (id === 'modal-event-detail') {
                const card = document.getElementById('event-detail-card');
                card.classList.add('translate-y-full');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            } else {
                modal.classList.add('hidden');
            }
        }
        
        // Start
        init();
    </script>
</body>
</html>
